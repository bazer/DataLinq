<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> | DataLinq </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" | DataLinq ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/bazer/DataLinq/blob/master/docs/Source Generator.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="DataLinq">
            DataLinq
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<h2 id="source-generator-overview">Source Generator Overview</h2>
<p>The DataLinq source generator automates the creation of immutable and mutable model classes, along with associated interfaces and extension methods. Its primary goal is to eliminate boilerplate code while ensuring that the generated models accurately reflect the underlying database schema and developer-defined attributes. The source generator accomplishes this by analyzing existing source code to build a comprehensive metadata representation, then using that metadata to produce additional source files that are incorporated into the compilation.</p>
<hr>
<h2 id="key-components-and-workflow">Key Components and Workflow</h2>
<h3 id="1-model-and-syntax-collection">1. <strong>Model and Syntax Collection</strong></h3>
<ul>
<li><strong>Syntax Provider:</strong><br>
The generator starts by scanning the source code using Roslyn’s syntax provider.
<ul>
<li>It identifies candidate model declarations by checking for classes that implement one of the key model interfaces (e.g., <code>ITableModel</code>, <code>IViewModel</code>, or custom variants).</li>
<li>The predicate function (<code>IsModelDeclaration</code>) quickly filters out irrelevant syntax nodes, while a transformation function extracts the corresponding <code>TypeDeclarationSyntax</code> for further analysis.</li>
</ul>
</li>
</ul>
<h3 id="2-metadata-extraction">2. <strong>Metadata Extraction</strong></h3>
<ul>
<li><p><strong>SyntaxParser:</strong><br>
Processes the collected syntax trees to extract model information.</p>
<ul>
<li>It parses class declarations to create a <code>ModelDefinition</code> that includes C# type details, properties, attributes, and using directives.</li>
<li>It distinguishes between value properties and relation properties, building a detailed blueprint for each model.</li>
</ul>
</li>
<li><p><strong>Metadata Factories:</strong><br>
Two primary factories convert syntax into metadata:</p>
<ul>
<li><strong>MetadataFromModelsFactory:</strong><br>
Consumes the <code>TypeDeclarationSyntax</code> nodes to produce a <code>DatabaseDefinition</code> that aggregates all model definitions, table definitions, and relational mappings.</li>
<li><strong>MetadataFromFileFactory:</strong><br>
Offers an alternative approach by reading source files from specified directories, enabling external models to be integrated into the metadata.</li>
</ul>
</li>
<li><p><strong>MetadataFactory and Transformers:</strong></p>
<ul>
<li>The <strong>MetadataFactory</strong> converts <code>ModelDefinition</code> instances into <code>TableDefinition</code> or <code>ViewDefinition</code> objects, applying attributes such as <code>[Table]</code>, <code>[UseCache]</code>, and caching limits.</li>
<li>The <strong>MetadataTransformer</strong> further refines the metadata, for example, by removing interface prefixes and updating constraint names as needed.</li>
<li><strong>MetadataTypeConverter</strong> assists by mapping C# type names to their database equivalents and calculating sizes and nullability.</li>
</ul>
</li>
</ul>
<h3 id="3-file-generation">3. <strong>File Generation</strong></h3>
<ul>
<li><p><strong>GeneratorFileFactory:</strong><br>
This component is responsible for producing the output files based on the extracted metadata.</p>
<ul>
<li>It defines options such as namespace, tab indentation, and whether to generate records or use file-scoped namespaces.</li>
<li>The factory constructs file headers (including using directives and namespace declarations), generates the body of the file by combining model properties, attributes, and method definitions, and then appends footers.</li>
<li>It produces files for both the main database definition and each individual table or view model.</li>
</ul>
</li>
<li><p><strong>ModelFileFactory:</strong><br>
Further refines the file generation for individual models.</p>
<ul>
<li>It creates files that include generated interfaces, immutable class definitions, mutable class definitions, and extension methods.</li>
<li>This component ensures that all aspects of a model (from column mapping to relation handling) are represented in the generated code.</li>
</ul>
</li>
</ul>
<h3 id="4-integration-into-compilation">4. <strong>Integration into Compilation</strong></h3>
<ul>
<li><p><strong>ModelGenerator (IIncrementalGenerator):</strong><br>
The entry point for the source generator.</p>
<ul>
<li>It registers the syntax provider to continuously monitor changes in the source code.</li>
<li>The generator combines the collected syntax nodes with the overall compilation and then passes them to the metadata factories.</li>
<li>Generated files are then added to the compilation context via <code>context.AddSource</code>, ensuring that they become part of the project without requiring manual inclusion.</li>
</ul>
</li>
<li><p><strong>Configuration and Options:</strong><br>
The generator checks compilation options (such as nullable reference types) and applies settings accordingly. This ensures that generated code aligns with the project’s language version and coding standards.</p>
</li>
</ul>
<hr>
<h2 id="summary">Summary</h2>
<p>The DataLinq source generator operates in four key phases:</p>
<ol>
<li><p><strong>Collection:</strong><br>
It scans the codebase for model declarations using Roslyn’s syntax provider.</p>
</li>
<li><p><strong>Metadata Extraction:</strong><br>
It transforms syntax nodes into rich metadata representations, capturing database schema, column definitions, relations, and model attributes.</p>
</li>
<li><p><strong>File Generation:</strong><br>
Using the metadata, it generates source files that define immutable and mutable models, interfaces, and extension methods. These files include all necessary attributes, property definitions, and helper methods for CRUD operations.</p>
</li>
<li><p><strong>Compilation Integration:</strong><br>
The generated files are seamlessly added to the compilation, ensuring that the ORM remains in sync with the underlying model definitions.</p>
</li>
</ol>
<p>This modular approach minimizes boilerplate, enforces consistency, and allows developers to focus on business logic rather than repetitive code. The source generator’s design also facilitates easy customization and extension, making it a core strength of the DataLinq project.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/bazer/DataLinq/blob/master/docs/Source Generator.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
